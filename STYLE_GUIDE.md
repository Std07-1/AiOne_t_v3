# Style_guide

# Стиль проєкту AiOne_t

Усі модулі мають виглядати так, ніби їх писала одна людина. Це документ фіксує єдиний стиль (українська мова, структура секцій, формат логування, коментарі, докстрінги).

## 1. Заголовок модуля
На початку кожного `.py` файлу:
```python
"""
Короткий опис модуля (1–2 рядки)
Детальніший опис (опціонально, 3–6 рядків) з контекстом / призначенням.

Особливості / ключові ідеї (булети, якщо потрібно):
  • пункт 1
  • пункт 2
"""
```

Дозволено (рекомендовано) додавати підпис кодування на першому рядку файлу:
```python
# -*- coding: utf-8 -*-
```

## 2. Розділювачі секцій
Використовуємо **один формат**:
```python
# ───────────────────────────── Назва секції ─────────────────────────────
```
Для дуже коротких «внутрішніх» підсекцій можна використовувати:
```python
# --- Логування ---
```
Це допускається лише для малого локального блоку (ініціалізація логера, дрібні константи).

Порядок секцій (рекомендований шаблон):
1. Докстрінг модуля
2. Імпорти (stdlib → third-party → internal) з порожнім рядком між групами
3. Логування модуля
4. Константи / конфіг
5. Класи моделей / dataclass / pydantic (якщо є)
6. Основні публічні функції / класи
7. Допоміжні (приватні) функції (`_helper`)
8. Тести самоперевірки (якщо залишаємо тимчасово — позначити `# DEBUG / TODO: remove`)
9. `__all__` (якщо потрібен контроль експорту)

## 3. Імпорти
- Сортуємо за групами і всередині груп — алфавітно.
- Не використовуємо `from x import *`.
- Внутрішні імпорти відносно кореня (у проєкті вже застосовано root‑style `from app...`).

Групи імпортів (із порожнім рядком між групами):
1) Стандартна бібліотека (спочатку `import ...`, потім `from ... import ...`),
2) Сторонні бібліотеки (наприклад, `rich`),
3) Модулі проєкту (first‑party): `config`, `app`, `data`, `stage1/2/3`, `UI`, `utils`, `monitoring`.

## 4. Мова
- Українська для всіх коментарів, логів, докстрінгів.
- Англійська допускається тільки для загальновідомих фінансових термінів (TP, SL, RSI) і в коді (імена змінних / методів / моделей).

## 5. Докстрінги (Google style)
Формат:
```python
def some_function(x: int, y: int) -> int:
    """Короткий опис у першому рядку.

    Розширений опис (за потреби) 1–3 речення.

    Args:
        x: опис.
        y: опис.

    Returns:
        int: Що повертає.

    Raises:
        ValueError: коли...
    """
```

## 6. Логування
Шаблон ініціалізації:
```python
import logging
from rich.logging import RichHandler
from rich.console import Console

logger = logging.getLogger("ім'я.модуля")
if not logger.handlers:  # захист від подвійної ініціалізації
    logger.setLevel(logging.INFO)
    logger.addHandler(RichHandler(console=Console(stderr=True), show_path=False))
    logger.propagate = False
```

Правила:
- Рівні: `info` для життєвих подій, `warning` для відхилень, `error` для винятків, `debug` для діагностики.
- Не логуємо надто великі об’єкти повністю — робимо слайси / агрегати.

## 7. Типізація
- Усі публічні функції мають анотації типів.
- Внутрішні (_приватні) теж бажано, якщо не тривіально.

## 8. Стиль рядків
- Максимум 88 символів (Black профіль; уніфіковано з ruff/isort).
- Форматування f-рядків замість конкатенації.

## 9. Константи
- UPPER_SNAKE_CASE.
- Якщо константа експортується — додати до `__all__`.

## 10. Експорт API
- Якщо модуль вживається як бібліотечний — додаємо `__all__` наприкінці.

## 11. Коментарі
- Коментар пояснює «чому», не переписує «що робить код».
- Однорядкові службові: `# TODO:`, `# NOTE:`, `# FIXME:`.

## 12. Обробка помилок
- Не ковтаємо винятки без логування.
- Якщо робимо `except Exception`, треба коментар `# broad except: ...`.

## 13. Приклади шаблонів секцій
```python
# ───────────────────────────── Логування ─────────────────────────────
logger = logging.getLogger("app.stage2.level_manager")
if not logger.handlers:
    logger.setLevel(logging.INFO)
    logger.addHandler(RichHandler(console=Console(stderr=True), show_path=False))
    logger.propagate = False

# --- Константи ---
MAX_SYMBOLS = 350
```

## 14. Заборонено
- Коментарі іншою мовою впереміш.
- Неоднорідні розділювачі (`########`, `====`, тощо).
- Надлишковий ASCII‑арт, випадкові емодзі.

## 15. Еволюція
Цей файл доповнюється при появі нових патернів. Pull‑request з правками стилю має посилатися на розділ.

---
Оновлено: v1 (початкова уніфікація)

## 16. Нагадування про уніфікований стиль

Щоб всі модулі залишалися однорідними, дотримуємося єдиних налаштувань інструментів і правил:

- Джерело правди (канон):
    - Форматування: Black, довжина рядка 88 символів.
    - Lint: Ruff (порядок імпортів, pycodestyle/pyflakes/bugbear/pyupgrade/naming).
    - Типи: mypy (анотації для публічних API; PEP 604 `X | None`).
    - Тести: pytest (arrange → act → assert; фікстури; edge cases).
    - Докстрінги: Google‑style; українською; опис одиниць вимірювання.
    - Логи: лише `logging`, структуровані поля через `extra={...}`; без секретів.

- Команди перевірок перед PR:
    - `ruff check .`
    - `python -m mypy .`
    - `python -m pytest -q`

- Імпорти:
    - Групи: stdlib → third‑party → first‑party (`app`, `data`, `stage1`, `stage2`, `stage3`, `UI`, `QDE`, `utils`, `monitoring`, `config`).
    - Вирівнювання й сортування — isort (профіль black) або правила Ruff.

- Контракти методів:
    - Вхід/вихід типізовані; жодних «магічних» кортежів — `dataclass(slots=True)`/`TypedDict`.
    - Конкретні винятки + `raise ... from e`.
    - Сайд‑ефекти явно в docstring (I/O, мережа, Redis, файли).
    - Для IO додаємо `timeout: float | None = 3.0` у сигнатурі.

- Узгодження конфігурацій:
    - Використовуємо єдину довжину рядка 88 (Black і Ruff). Якщо в конфігах є розбіжності — вирівняти.
    - Винести правила Ruff або у `pyproject.toml` (секція `[tool.ruff]`), або в `ruff.toml` — але не дублювати обидва з різними значеннями.

- Додатково:
    - Перед комітом: прибрати `print`, великі відлагоджувальні блоки позначати `# DEBUG` і видаляти перед злиттям.
    - Для великих змін — короткі перформанс‑нотатки (складність, пам'ять, latency, кешування).
    - Оновлювати/додавати тести при зміні публічної поведінки.

Посилання:
- Канонічні інструкції для Copilot: `.github/copilot-instructions.md` (контракти методів, типізація, логи, тести, перформанс‑вимоги).
